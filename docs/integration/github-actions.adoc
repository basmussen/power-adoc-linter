= GitHub Actions Integration
:toc:
:toc-title: Inhalt
:toclevels: 2
:icons: font
:source-highlighter: rouge

[abstract]
Integrieren Sie den Power AsciiDoc Linter nahtlos in Ihre GitHub Actions Workflows f√ºr automatisierte Dokumentenvalidierung bei jedem Push oder Pull Request.

== Schnellstart

Erstellen Sie `.github/workflows/asciidoc-lint.yml`:

[source,yaml]
----
name: AsciiDoc Linter

on:
  push:
    branches: [ main, develop ]
    paths:
      - '**.adoc'
      - '**.asciidoc'
      - '.linter-config.yaml'
  pull_request:
    paths:
      - '**.adoc'
      - '**.asciidoc'

jobs:
  lint:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Java
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
    
    - name: Download Linter
      run: |
        wget -q https://github.com/basmussen/power-adoc-linter/releases/latest/download/power-adoc-linter.jar
    
    - name: Run Linter
      run: |
        java -jar power-adoc-linter.jar \
          -i "**/*.adoc" \
          -c .linter-config.yaml \
          -f console
----

== Erweiterte Workflows

=== Mit Artefakt-Upload

[source,yaml]
----
name: Documentation Validation

on: [push, pull_request]

jobs:
  validate-docs:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
    
    - name: Cache Linter
      uses: actions/cache@v3
      with:
        path: ~/.linter
        key: linter-${{ runner.os }}-${{ hashFiles('.linter-version') }}
    
    - name: Download Linter
      run: |
        mkdir -p ~/.linter
        if [ ! -f ~/.linter/power-adoc-linter.jar ]; then
          wget -q https://github.com/basmussen/power-adoc-linter/releases/latest/download/power-adoc-linter.jar \
            -O ~/.linter/power-adoc-linter.jar
        fi
    
    - name: Validate Documentation
      run: |
        java -jar ~/.linter/power-adoc-linter.jar \
          -i "docs/**/*.adoc,README.adoc" \
          -c .linter-config.yaml \
          -f json \
          -o validation-report.json
    
    - name: Upload Report
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: validation-report
        path: validation-report.json
        retention-days: 30
----

=== Matrix-Build f√ºr verschiedene Konfigurationen

[source,yaml]
----
name: Multi-Config Validation

on: [push]

jobs:
  lint:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        config:
          - name: "User Docs"
            pattern: "user-guide/**/*.adoc"
            rules: "rules/user-docs.yaml"
          - name: "API Docs"
            pattern: "api/**/*.adoc"
            rules: "rules/api-docs.yaml"
          - name: "Dev Docs"
            pattern: "dev/**/*.adoc"
            rules: "rules/dev-docs.yaml"
    
    name: Validate ${{ matrix.config.name }}
    
    steps:
    - uses: actions/checkout@v4
    
    - uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
    
    - name: Download Linter
      run: wget -q https://github.com/basmussen/power-adoc-linter/releases/latest/download/power-adoc-linter.jar
    
    - name: Run Validation
      run: |
        java -jar power-adoc-linter.jar \
          -i "${{ matrix.config.pattern }}" \
          -c "${{ matrix.config.rules }}" \
          -l warn
----

=== Pull Request Kommentare

[source,yaml]
----
name: PR Documentation Check

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  lint-and-comment:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      
    steps:
    - uses: actions/checkout@v4
    
    - uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
    
    - name: Run Linter
      id: lint
      run: |
        wget -q https://github.com/basmussen/power-adoc-linter/releases/latest/download/power-adoc-linter.jar
        
        # Run linter and capture output
        java -jar power-adoc-linter.jar \
          -i "**/*.adoc" \
          -c .linter-config.yaml \
          -f json \
          -o report.json || true
        
        # Extract summary
        ERROR_COUNT=$(jq '.summary.errorCount // 0' report.json)
        WARN_COUNT=$(jq '.summary.warningCount // 0' report.json)
        
        echo "error_count=$ERROR_COUNT" >> $GITHUB_OUTPUT
        echo "warn_count=$WARN_COUNT" >> $GITHUB_OUTPUT
    
    - name: Comment PR
      uses: actions/github-script@v7
      if: steps.lint.outputs.error_count > 0 || steps.lint.outputs.warn_count > 0
      with:
        script: |
          const fs = require('fs');
          const report = JSON.parse(fs.readFileSync('report.json', 'utf8'));
          
          let comment = '## üìã AsciiDoc Linter Report\n\n';
          comment += `- **Errors**: ${report.summary.errorCount || 0}\n`;
          comment += `- **Warnings**: ${report.summary.warningCount || 0}\n\n`;
          
          if (report.validations && report.validations.length > 0) {
            comment += '### Issues Found:\n\n';
            report.validations.forEach(file => {
              if (file.errors && file.errors.length > 0) {
                comment += `**${file.file}**\n`;
                file.errors.forEach(error => {
                  comment += `- Line ${error.line}: ${error.message} (${error.severity})\n`;
                });
                comment += '\n';
              }
            });
          }
          
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: comment
          });
----

== Optimierungen

=== Caching f√ºr Performance

[source,yaml]
----
- name: Cache Linter JAR
  uses: actions/cache@v3
  with:
    path: |
      ~/.linter/power-adoc-linter.jar
    key: ${{ runner.os }}-linter-${{ hashFiles('.linter-version') }}
    restore-keys: |
      ${{ runner.os }}-linter-
----

=== Nur ge√§nderte Dateien pr√ºfen

[source,yaml]
----
- name: Get changed files
  id: changed-files
  uses: tj-actions/changed-files@v41
  with:
    files: |
      **.adoc
      **.asciidoc

- name: Lint changed files
  if: steps.changed-files.outputs.any_changed == 'true'
  run: |
    java -jar power-adoc-linter.jar \
      -i "${{ steps.changed-files.outputs.all_changed_files }}" \
      -c .linter-config.yaml
----

=== Parallelisierung

[source,yaml]
----
jobs:
  prepare:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.set-matrix.outputs.matrix }}
    steps:
    - uses: actions/checkout@v4
    - id: set-matrix
      run: |
        DIRS=$(find . -name "*.adoc" -type f | xargs dirname | sort -u | jq -R -s -c 'split("\n")[:-1]')
        echo "matrix={\"dir\":$DIRS}" >> $GITHUB_OUTPUT

  lint:
    needs: prepare
    runs-on: ubuntu-latest
    strategy:
      matrix: ${{fromJson(needs.prepare.outputs.matrix)}}
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-java@v4
      with:
        java-version: '17'
    - run: |
        wget -q https://github.com/basmussen/power-adoc-linter/releases/latest/download/power-adoc-linter.jar
        java -jar power-adoc-linter.jar -i "${{ matrix.dir }}/*.adoc" -c .linter-config.yaml
----

== Konfigurationsbeispiele

=== Strict Mode f√ºr Releases

[source,yaml]
----
name: Release Documentation Check

on:
  push:
    tags:
      - 'v*'

jobs:
  strict-validation:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
    
    - name: Strict Validation
      run: |
        wget -q https://github.com/basmussen/power-adoc-linter/releases/latest/download/power-adoc-linter.jar
        
        # Fail on warnings for releases
        java -jar power-adoc-linter.jar \
          -i "**/*.adoc" \
          -c .linter-config-strict.yaml \
          -l warn \
          -f json-compact
----

=== Scheduled Daily Check

[source,yaml]
----
name: Daily Documentation Audit

on:
  schedule:
    - cron: '0 2 * * *'  # 2 AM UTC t√§glich
  workflow_dispatch:

jobs:
  audit:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
    
    - name: Run Full Audit
      run: |
        wget -q https://github.com/basmussen/power-adoc-linter/releases/latest/download/power-adoc-linter.jar
        
        java -jar power-adoc-linter.jar \
          -i "**/*.adoc" \
          -c .linter-config.yaml \
          -f json \
          -o audit-report-$(date +%Y%m%d).json
    
    - name: Upload to S3
      env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      run: |
        aws s3 cp audit-report-*.json s3://doc-reports/daily/
----

== Fehlerbehandlung

=== Fortfahren bei Fehlern

[source,yaml]
----
- name: Run Linter (Continue on Error)
  continue-on-error: true
  id: linter
  run: |
    java -jar power-adoc-linter.jar -i "**/*.adoc" -c .linter-config.yaml

- name: Check Results
  if: steps.linter.outcome == 'failure'
  run: |
    echo "::warning::Documentation has validation errors"
----

=== Bedingte Aktionen

[source,yaml]
----
- name: Run Linter
  id: lint
  run: |
    if java -jar power-adoc-linter.jar -i "**/*.adoc" -c .linter-config.yaml; then
      echo "status=success" >> $GITHUB_OUTPUT
    else
      echo "status=failure" >> $GITHUB_OUTPUT
    fi

- name: Deploy Docs
  if: steps.lint.outputs.status == 'success'
  run: |
    echo "Deploying documentation..."
----

== Best Practices

1. **Caching nutzen**: Linter-JAR cachen f√ºr schnellere Builds
2. **Pfad-Filter**: Nur bei √Ñnderungen an .adoc-Dateien ausf√ºhren
3. **Matrix-Builds**: Verschiedene Dokumenttypen parallel pr√ºfen
4. **PR-Kommentare**: Entwickler direkt √ºber Probleme informieren
5. **Severity-Level**: `warn` f√ºr PRs, `error` f√ºr Releases

== Beispiel-Repository-Struktur

[source]
----
.github/
  workflows/
    asciidoc-lint.yml       # Haupt-Workflow
    asciidoc-pr.yml         # PR-spezifisch
.linter-config.yaml         # Standard-Regeln
.linter-config-strict.yaml  # Strikte Regeln f√ºr Releases
docs/
  *.adoc
----

== Siehe auch

* link:ci-cd.html[Allgemeine CI/CD Integration]
* link:../user-guide/configuration.html[Linter-Konfiguration]
* link:../reference/cli-options.html[CLI-Optionen]